<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}æœƒè­°åŠ©æ‰‹{% endblock %}</title>

    <!-- Bootstrap -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <!-- Gentelella Custom Theme Style -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/gentelella/1.4.0/css/custom.min.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="{{ url_for('static', filename='css/custom.css') }}" rel="stylesheet">
    
    <!-- ä¿®æ­£ä¸‹æ‹‰é¸å–®æ¨£å¼ -->
    <style>
        /* ä¿®æ­£é ‚éƒ¨å°èˆªä¸‹æ‹‰é¸å–®å•é¡Œ */
        .top_nav .nav.navbar-nav {
            position: relative;
        }
        
        .top_nav .nav-item.dropdown {
            position: relative;
        }
        
        .top_nav .dropdown-menu {
            position: absolute !important;
            top: 100% !important;
            right: 0 !important;
            left: auto !important;
            z-index: 1050 !important;
            min-width: 160px;
            background-color: #fff;
            border: 1px solid rgba(0,0,0,.15);
            border-radius: 4px;
            box-shadow: 0 6px 12px rgba(0,0,0,.175);
            background-clip: padding-box;
            transform: none !important;
        }
        
        .top_nav .dropdown-menu.show,
        .top_nav .dropdown.open .dropdown-menu {
            display: block;
        }
        
        .top_nav .dropdown-menu .dropdown-item {
            display: block;
            width: 100%;
            padding: 3px 20px;
            clear: both;
            font-weight: normal;
            line-height: 1.42857143;
            color: #333;
            white-space: nowrap;
            text-decoration: none;
        }
        
        .top_nav .dropdown-menu .dropdown-item:hover,
        .top_nav .dropdown-menu .dropdown-item:focus {
            background-color: #f5f5f5;
            color: #262626;
        }
        
        /* ç¢ºä¿ç”¨æˆ¶é¸å–®æŒ‰éˆ•æ¨£å¼æ­£ç¢º */
        .top_nav .user-profile {
            color: #5A738E;
            text-decoration: none;
            padding: 15px;
            display: block;
        }
        
        .top_nav .user-profile:hover {
            color: #5A738E;
            text-decoration: none;
        }
        
        /* ä¿®æ­£å°èˆªåˆ—æ•´é«”ä½ˆå±€ */
        .top_nav .nav_menu {
            position: relative;
        }
        
        .top_nav .navbar-right {
            float: right !important;
            margin-right: 0;
        }
    </style>
    
    {% block extra_css %}{% endblock %}
    
    <!-- èª¿è©¦è…³æœ¬ - ç›£æ§CSSè¼‰å…¥ -->
    <script>
        console.log('ğŸ”„ é é¢é–‹å§‹è¼‰å…¥: ' + new Date().toLocaleTimeString());
        console.log('ğŸ“‘ æ–‡æª”å°±ç·’ç‹€æ…‹: ' + document.readyState);
        
        // ç›£æ§æ¨£å¼è¡¨è¼‰å…¥
        const cssFiles = {
            'Bootstrap': 'bootstrap.min.css',
            'Font Awesome': 'font-awesome.min.css',
            'Gentelella': 'custom.min.css',
            'è‡ªè¨‚æ¨£å¼': 'custom.css'
        };
        
        function checkStylesheets() {
            console.log('ğŸ¨ æª¢æŸ¥æ¨£å¼è¡¨è¼‰å…¥ç‹€æ…‹:');
            const loadedSheets = Array.from(document.styleSheets).map(sheet => sheet.href || 'inline');
            
            for (const [name, identifier] of Object.entries(cssFiles)) {
                const isLoaded = loadedSheets.some(href => href.includes(identifier));
                console.log(`  ${name}: ${isLoaded ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}`);
            }
        }
        
        // é é¢è¼‰å…¥æ™‚æª¢æŸ¥
        window.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”„ DOM å…§å®¹å·²è¼‰å…¥: ' + new Date().toLocaleTimeString());
            checkStylesheets();
            
            // èª¿è©¦ä¸‹æ‹‰é¸å–®å…ƒç´ 
            console.log('ğŸ” æª¢æŸ¥ä¸‹æ‹‰é¸å–®å…ƒç´ :');
            const dropdown = document.querySelector('.nav-item.dropdown');
            if (dropdown) {
                console.log('  ä¸‹æ‹‰é¸å–®å®¹å™¨: âœ… æ‰¾åˆ°');
                console.log('  å®¹å™¨ä½ç½®:', dropdown.getBoundingClientRect());
                console.log('  å®¹å™¨æ¨£å¼:', window.getComputedStyle(dropdown));
                
                const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                if (dropdownMenu) {
                    console.log('  ä¸‹æ‹‰é¸å–®: âœ… æ‰¾åˆ°');
                    console.log('  é¸å–®ä½ç½®:', dropdownMenu.getBoundingClientRect());
                    console.log('  é¸å–®æ¨£å¼:', window.getComputedStyle(dropdownMenu));
                } else {
                    console.log('  ä¸‹æ‹‰é¸å–®: âŒ æœªæ‰¾åˆ°');
                }
            } else {
                console.log('  ä¸‹æ‹‰é¸å–®å®¹å™¨: âŒ æœªæ‰¾åˆ°');
            }
        });
    </script>
</head>

<body class="nav-md">
    <div class="container body">
        <div class="main_container">
            <!-- å´é‚Šæ¬„ -->
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0;">
                        <a href="{{ url_for('main.index') }}" class="site_title">
                            <i class="fa fa-microphone"></i> 
                            <span>æœƒè­°åŠ©æ‰‹</span>
                        </a>
                    </div>

                    <div class="clearfix"></div>

                    <!-- ä¸»é¸å–® -->
                    <div id="sidebar-menu" class="main_menu_side hidden-print main_menu">
                        <div class="menu_section">
                            <h3>åŠŸèƒ½é¸å–®</h3>
                            <ul class="nav side-menu">
                                <li class="{% if request.endpoint == 'main.index' %}active{% endif %}">
                                    <a href="{{ url_for('main.index') }}">
                                        <i class="fa fa-upload"></i> ä¸Šå‚³éŸ³è¨Š
                                    </a>
                                </li>
                                <li class="{% if request.endpoint == 'main.meetings_list' %}active{% endif %}">
                                    <a href="{{ url_for('main.meetings_list') }}">
                                        <i class="fa fa-list"></i> æœƒè­°è¨˜éŒ„
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é ‚éƒ¨å°èˆª - ä¿®æ­£ç‰ˆ -->
            <div class="top_nav">
                <div class="nav_menu">
                    <div class="nav toggle">
                        <a id="menu_toggle"><i class="fa fa-bars"></i></a>
                    </div>
                    
                    <nav class="nav navbar-nav">
                        <ul class="navbar-right">
                            <li class="nav-item dropdown">
                                <a href="#" class="user-profile dropdown-toggle" 
                                   data-toggle="dropdown" 
                                   aria-haspopup="true" 
                                   aria-expanded="false"
                                   role="button">
                                    <i class="fa fa-user"></i> ç”¨æˆ¶é¸å–® <span class="caret"></span>
                                </a>
                                <ul class="dropdown-menu dropdown-usermenu">
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('main.index') }}">
                                            <i class="fa fa-home pull-right"></i> é¦–é 
                                        </a>
                                    </li>
                                    <li>
                                        <a class="dropdown-item" href="{{ url_for('main.meetings_list') }}">
                                            <i class="fa fa-list pull-right"></i> æœƒè­°è¨˜éŒ„
                                        </a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>

            <!-- ä¸»è¦å…§å®¹å€åŸŸ -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="clearfix"></div>

                    <!-- Flash è¨Šæ¯é¡¯ç¤º -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                        {% if messages %}
                            <div class="row">
                                <div class="col-md-12">
                                    {% for category, message in messages %}
                                        <div class="alert alert-{% if category == 'error' %}danger{% else %}{{ category }}{% endif %} alert-dismissible fade in" role="alert">
                                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                                <span aria-hidden="true">Ã—</span>
                                            </button>
                                            {{ message }}
                                        </div>
                                    {% endfor %}
                                </div>
                            </div>
                        {% endif %}
                    {% endwith %}

                    <!-- é é¢æ¨™é¡Œ -->
                    <div class="page-title">
                        <div class="title_left">
                            <h3>{% block page_title %}æœƒè­°åŠ©æ‰‹{% endblock %}</h3>
                        </div>
                        <div class="title_right">
                            <div class="col-md-5 col-sm-5 form-group pull-right top_search">
                                <div class="input-group">
                                    <span class="input-group-btn">
                                        {% block page_actions %}{% endblock %}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ä¸»è¦å…§å®¹ -->
                    {% block content %}{% endblock %}
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript è¼‰å…¥èª¿è©¦ -->
    <script>
        console.log('ğŸ“œ é–‹å§‹è¼‰å…¥ JavaScript åº«: ' + new Date().toLocaleTimeString());
        
        // å‰µå»ºç›£æ§å‡½æ•¸
        function createScriptLoadMonitor(scriptName) {
            return function() {
                console.log(`ğŸ“œ ${scriptName} å·²è¼‰å…¥: ` + new Date().toLocaleTimeString());
                
                // æª¢æŸ¥å…¨å±€è®Šæ•¸
                if (scriptName === 'jQuery') {
                    console.log(`  jQuery ç‰ˆæœ¬: ${$.fn.jquery}`);
                    window._jQueryLoaded = true;
                }
                else if (scriptName === 'Bootstrap') {
                    console.log(`  Bootstrap å¯ç”¨: ${typeof $.fn.modal !== 'undefined' ? 'æ˜¯' : 'å¦'}`);
                    console.log(`  Bootstrap ä¸‹æ‹‰é¸å–®: ${typeof $.fn.dropdown !== 'undefined' ? 'æ˜¯' : 'å¦'}`);
                    window._bootstrapLoaded = true;
                }
                else if (scriptName === 'Gentelella') {
                    console.log(`  Gentelella å¯ç”¨: ${typeof $.fn.fullCalendar !== 'undefined' ? 'æ˜¯' : 'å¦'}`);
                    window._gentelellaLoaded = true;
                }
            };
        }
        
        // å‰µå»ºç›£æ§è…³æœ¬å…ƒç´ 
        function monitorScript(url, scriptName) {
            const originalScript = document.createElement('script');
            originalScript.src = url;
            originalScript.onload = createScriptLoadMonitor(scriptName);
            originalScript.onerror = function() {
                console.error(`âŒ ${scriptName} è¼‰å…¥å¤±æ•—!`);
            };
            return originalScript;
        }
    </script>

    <!-- JavaScript æ–‡ä»¶ - ä½¿ç”¨ç›£æ§ç‰ˆæœ¬ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" onload="createScriptLoadMonitor('jQuery')()" onerror="console.error('âŒ jQuery è¼‰å…¥å¤±æ•—!')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js" onload="createScriptLoadMonitor('jQuery UI')()" onerror="console.error('âŒ jQuery UI è¼‰å…¥å¤±æ•—!')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" onload="createScriptLoadMonitor('Bootstrap')()" onerror="console.error('âŒ Bootstrap è¼‰å…¥å¤±æ•—!')"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gentelella/1.4.0/js/custom.min.js" onload="createScriptLoadMonitor('Gentelella')()" onerror="console.error('âŒ Gentelella è¼‰å…¥å¤±æ•—!')"></script>
    
    <!-- Custom Theme Scripts -->
    <script src="{{ url_for('static', filename='js/main.js') }}" onload="console.log('ğŸ“œ è‡ªè¨‚è…³æœ¬å·²è¼‰å…¥: ' + new Date().toLocaleTimeString())" onerror="console.error('âŒ è‡ªè¨‚è…³æœ¬è¼‰å…¥å¤±æ•—!')"></script>
    
    {{ moment.include_moment() }}
    {% block extra_js %}{% endblock %}
    
    <script>
        $(document).ready(function() {
            console.log('ğŸš€ jQuery DOM Ready åŸ·è¡Œ: ' + new Date().toLocaleTimeString());
            
            // æª¢æŸ¥ä¸‹æ‹‰é¸å–®å…ƒç´ ç‹€æ…‹
            console.log('ğŸ” æª¢æŸ¥ä¸‹æ‹‰é¸å–®åˆå§‹åŒ–:');
            const $dropdown = $('.nav-item.dropdown');
            const $dropdownToggle = $('.dropdown-toggle');
            const $dropdownMenu = $('.dropdown-menu');
            
            console.log(`  æ‰¾åˆ° ${$dropdown.length} å€‹ä¸‹æ‹‰é¸å–®å®¹å™¨`);
            console.log(`  æ‰¾åˆ° ${$dropdownToggle.length} å€‹ä¸‹æ‹‰é¸å–®æŒ‰éˆ•`);
            console.log(`  æ‰¾åˆ° ${$dropdownMenu.length} å€‹ä¸‹æ‹‰é¸å–®`);
            
            // æª¢æŸ¥ Bootstrap ä¸‹æ‹‰é¸å–®åŠŸèƒ½
            if (typeof $.fn.dropdown !== 'undefined') {
                console.log('âœ… Bootstrap ä¸‹æ‹‰é¸å–®åŠŸèƒ½å¯ç”¨');
                // ç¢ºä¿ä¸‹æ‹‰é¸å–®æ­£å¸¸å·¥ä½œ
                $('.dropdown-toggle').dropdown();
                console.log('âœ… ä¸‹æ‹‰é¸å–®å·²åˆå§‹åŒ–');
            } else {
                console.error('âŒ Bootstrap ä¸‹æ‹‰é¸å–®åŠŸèƒ½ä¸å¯ç”¨');
            }
            
            // é»æ“Šå¤–éƒ¨é—œé–‰ä¸‹æ‹‰é¸å–®
            $(document).on('click', function(e) {
                if (!$(e.target).closest('.dropdown').length) {
                    console.log('ğŸ‘† é»æ“Šå¤–éƒ¨ï¼Œé—œé–‰ä¸‹æ‹‰é¸å–®');
                    $('.dropdown.open').removeClass('open');
                }
            });
            
            // ä¿®æ­£ä¸‹æ‹‰é¸å–®åˆ‡æ›
            $('.dropdown-toggle').on('click', function(e) {
                console.log('ğŸ‘† é»æ“Šä¸‹æ‹‰é¸å–®æŒ‰éˆ•');
                e.preventDefault();
                e.stopPropagation();
                
                var $dropdown = $(this).closest('.dropdown');
                var isOpen = $dropdown.hasClass('open');
                
                console.log(`  ç•¶å‰ç‹€æ…‹: ${isOpen ? 'å·²é–‹å•Ÿ' : 'å·²é—œé–‰'}`);
                
                // é—œé–‰æ‰€æœ‰å…¶ä»–ä¸‹æ‹‰é¸å–®
                $('.dropdown.open').removeClass('open');
                console.log('  å·²é—œé–‰æ‰€æœ‰å…¶ä»–ä¸‹æ‹‰é¸å–®');
                
                // åˆ‡æ›ç•¶å‰ä¸‹æ‹‰é¸å–®
                if (!isOpen) {
                    $dropdown.addClass('open');
                    console.log('  âœ… é–‹å•Ÿç•¶å‰ä¸‹æ‹‰é¸å–®');
                    
                    // æª¢æŸ¥ä¸‹æ‹‰é¸å–®ä½ç½®
                    const $menu = $dropdown.find('.dropdown-menu');
                    const menuRect = $menu[0].getBoundingClientRect();
                    console.log('  ä¸‹æ‹‰é¸å–®ä½ç½®:', menuRect);
                } else {
                    console.log('  âœ… é—œé–‰ç•¶å‰ä¸‹æ‹‰é¸å–®');
                }
            });
            
            // ç›£æ§ä¸‹æ‹‰é¸å–®ç‹€æ…‹è®ŠåŒ–
            $('.dropdown').on('show.bs.dropdown', function() {
                console.log('ğŸ“‹ Bootstrap ä¸‹æ‹‰é¸å–®é¡¯ç¤ºäº‹ä»¶è§¸ç™¼');
            });
            
            $('.dropdown').on('hide.bs.dropdown', function() {
                console.log('ğŸ“‹ Bootstrap ä¸‹æ‹‰é¸å–®éš±è—äº‹ä»¶è§¸ç™¼');
            });
        });
        
        // é é¢å®Œå…¨è¼‰å…¥å¾Œçš„æª¢æŸ¥
        window.addEventListener('load', function() {
            console.log('ğŸ é é¢å®Œå…¨è¼‰å…¥: ' + new Date().toLocaleTimeString());
            console.log('ğŸ“Š è…³æœ¬è¼‰å…¥ç‹€æ…‹æª¢æŸ¥:');
            console.log(`  jQuery: ${window._jQueryLoaded ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}`);
            console.log(`  Bootstrap: ${window._bootstrapLoaded ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}`);
            console.log(`  Gentelella: ${window._gentelellaLoaded ? 'âœ… å·²è¼‰å…¥' : 'âŒ æœªè¼‰å…¥'}`);
            
            // æª¢æŸ¥ Alert å…ƒç´ 
            const alerts = $('.alert');
            console.log(`ğŸš¨ é é¢è¼‰å…¥å®Œæˆæ™‚æœ‰ ${alerts.length} å€‹ Alert å…ƒç´ `);
            alerts.each(function(index) {
                console.log(`  Alert ${index + 1}: é¡åˆ¥=${$(this).attr('class')}`);
                
                // æª¢æŸ¥æ˜¯å¦æœ‰è‡ªå‹•é—œé–‰çš„äº‹ä»¶ç¶å®š
                const closeEvents = $._data($(this)[0], 'events');
                console.log(`  Alert ${index + 1} äº‹ä»¶:`, closeEvents);
            });
            
            // æœ€çµ‚ä¸‹æ‹‰é¸å–®æª¢æŸ¥
            console.log('ğŸ” æœ€çµ‚ä¸‹æ‹‰é¸å–®ç‹€æ…‹æª¢æŸ¥:');
            const dropdown = document.querySelector('.nav-item.dropdown');
            if (dropdown) {
                const computedStyle = window.getComputedStyle(dropdown);
                console.log('  ä¸‹æ‹‰é¸å–®å®¹å™¨ position:', computedStyle.position);
                console.log('  ä¸‹æ‹‰é¸å–®å®¹å™¨ z-index:', computedStyle.zIndex);
                
                const dropdownMenu = dropdown.querySelector('.dropdown-menu');
                if (dropdownMenu) {
                    const menuStyle = window.getComputedStyle(dropdownMenu);
                    console.log('  ä¸‹æ‹‰é¸å–® position:', menuStyle.position);
                    console.log('  ä¸‹æ‹‰é¸å–® z-index:', menuStyle.zIndex);
                    console.log('  ä¸‹æ‹‰é¸å–® display:', menuStyle.display);
                    console.log('  ä¸‹æ‹‰é¸å–® top:', menuStyle.top);
                    console.log('  ä¸‹æ‹‰é¸å–® right:', menuStyle.right);
                }
            }
        });
    </script>
</body>
</html>
{% extends "base.html" %}

{% block title %}ä¸Šå‚³éŸ³è¨Š - æœƒè­°åŠ©æ‰‹{% endblock %}
{% block page_title %}ä¸Šå‚³æœƒè­°éŸ³è¨Š{% endblock %}

{% block page_actions %}
<a href="{{ url_for('main.meetings_list') }}" class="btn btn-info btn-sm">
    <i class="fa fa-list"></i> æŸ¥çœ‹æ‰€æœ‰æœƒè­°
</a>
{% endblock %}

{% block content %}
<!-- ä¸»è¦ä¸Šå‚³å€åŸŸ - æ”¹ç‚ºä¸­å¤®å°é½Šçš„å–®æ¬„è¨­è¨ˆ -->
<div class="row">
    <div class="col-lg-10 col-lg-offset-1 col-md-12">
        <div class="x_panel fade-in upload-main-panel">
            <div class="x_title">
                <h2><i class="fa fa-cloud-upload"></i> ä¸Šå‚³æœƒè­°éŸ³è¨Šæª”æ¡ˆ</h2>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <!-- æ”¯æ´çš„æ ¼å¼èªªæ˜ - ä½¿ç”¨ç‰¹æ®Šé¡åˆ¥é¿å…è¢«èª¤åˆª -->
                <div class="alert alert-info format-info-permanent">
                    <div class="row">
                        <div class="col-md-8">
                            <h4><i class="fa fa-info-circle"></i> æ”¯æ´æ ¼å¼</h4>
                            <p><strong>æª”æ¡ˆæ ¼å¼ï¼š</strong>M4Aã€MP3ã€WAVã€FLACã€WebM (æœ€å¤§ 500MB)</p>
                        </div>
                        <div class="col-md-4">
                            <h4><i class="fa fa-magic"></i> AI è™•ç†</h4>
                            <p>èªéŸ³è½‰æ–‡å­— â†’ èªè€…è¾¨è­˜ â†’ æ™ºæ…§æ‘˜è¦</p>
                        </div>
                    </div>
                </div>

                <!-- ä¸Šå‚³è¡¨å–® -->
                <form id="uploadForm" action="{{ url_for('main.upload_file') }}" method="post" enctype="multipart/form-data">
                    <!-- æ‹–æ”¾ä¸Šå‚³å€åŸŸ - æ”¹ç‚ºæ›´å¤§ã€æ›´çªå‡ºçš„è¨­è¨ˆ -->
                    <div class="upload-area enhanced" id="uploadArea">
                        <div class="upload-content">
                            <div class="upload-icon">
                                <i class="fa fa-cloud-upload"></i>
                            </div>
                            <h3>æ‹–æ”¾éŸ³è¨Šæª”æ¡ˆåˆ°æ­¤è™•</h3>
                            <p class="upload-subtitle">æˆ–é»æ“Šä¸‹æ–¹æŒ‰éˆ•é¸æ“‡æª”æ¡ˆ</p>
                            <input type="file" id="fileInput" name="file" accept=".m4a,.mp3,.wav,.flac,.webm" style="display: none;">
                            <button type="button" class="btn btn-primary btn-lg upload-btn" onclick="document.getElementById('fileInput').click();">
                                <i class="fa fa-folder-open"></i> é¸æ“‡æª”æ¡ˆ
                            </button>
                        </div>
                        
                        <!-- æª”æ¡ˆè³‡è¨Šé¡¯ç¤ºå€åŸŸ -->
                        <div id="fileInfo" class="file-info enhanced" style="display: none;">
                            <div class="file-preview">
                                <div class="file-icon">
                                    <i class="fa fa-file-audio-o"></i>
                                </div>
                                <div class="file-details">
                                    <h5 id="fileName"></h5>
                                    <p id="fileSize" class="file-meta"></p>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-success btn-lg process-btn">
                                <i class="fa fa-upload"></i> é–‹å§‹ä¸Šå‚³ä¸¦è™•ç†
                            </button>
                        </div>
                    </div>
                </form>

                <!-- ä¸Šå‚³é€²åº¦æ¢ -->
                <div id="uploadProgress" class="progress-container enhanced" style="display: none;">
                    <div class="progress-header">
                        <h4><i class="fa fa-spinner fa-spin"></i> æª”æ¡ˆè™•ç†ä¸­...</h4>
                        <p id="progressText" class="progress-description">æº–å‚™ä¸­...</p>
                    </div>
                    
                    <div class="progress progress-striped active">
                        <div class="progress-bar progress-bar-success" id="progressBar" style="width: 0%"></div>
                    </div>
                    
                    <!-- è™•ç†æ­¥é©ŸæŒ‡ç¤ºå™¨ - æ”¹ç‚ºæ©«å‘å¡ç‰‡å¼ -->
                    <div class="processing-steps-horizontal" id="processingSteps">
                        <div class="step-card active" id="step1">
                            <div class="step-icon">
                                <i class="fa fa-upload"></i>
                            </div>
                            <div class="step-label">æª”æ¡ˆä¸Šå‚³</div>
                        </div>
                        <div class="step-card" id="step2">
                            <div class="step-icon">
                                <i class="fa fa-circle-o"></i>
                            </div>
                            <div class="step-label">éŸ³è¨Šé è™•ç†</div>
                        </div>
                        <div class="step-card" id="step3">
                            <div class="step-icon">
                                <i class="fa fa-circle-o"></i>
                            </div>
                            <div class="step-label">èªéŸ³è½‰æ–‡å­—</div>
                        </div>
                        <div class="step-card" id="step4">
                            <div class="step-icon">
                                <i class="fa fa-circle-o"></i>
                            </div>
                            <div class="step-label">èªè€…è¾¨è­˜</div>
                        </div>
                        <div class="step-card" id="step5">
                            <div class="step-icon">
                                <i class="fa fa-circle-o"></i>
                            </div>
                            <div class="step-label">ç”Ÿæˆçµæœ</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- é€²éšè¨­å®šèˆ‡èªªæ˜ - æ”¹ç‚ºå¯æ‘ºç–Šçš„æ©«å‘å¸ƒå±€ -->
<div class="row" id="advancedSection">
    <div class="col-md-6">
        <div class="x_panel fade-in">
            <div class="x_title">
                <h2><i class="fa fa-cogs"></i> é€²éšè¨­å®š</h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="form-group">
                    <label for="numSpeakers">é æœŸèªè€…æ•¸é‡ï¼ˆå¯é¸ï¼‰</label>
                    <div class="input-group">
                        <input type="number" class="form-control" id="numSpeakers" name="num_speakers" 
                               min="1" max="10" placeholder="ç³»çµ±è‡ªå‹•åµæ¸¬" form="uploadForm">
                        <span class="input-group-addon">äºº</span>
                    </div>
                    <small class="help-block">
                        è¼¸å…¥é æœŸç™¼è¨€äººæ•¸å¯æé«˜èªè€…è¾¨è­˜æº–ç¢ºåº¦
                    </small>
                </div>
                
                <div class="form-group">
                    <div class="checkbox">
                        <label>
                            <input type="checkbox" id="autoProcess" checked form="uploadForm"> 
                            ä¸Šå‚³å¾Œè‡ªå‹•é–‹å§‹è™•ç†
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>éŸ³è¨Šå“è³ªå»ºè­°</label>
                    <div class="well well-sm">
                        <ul class="list-unstyled quality-tips">
                            <li><i class="fa fa-check text-success"></i> ä½¿ç”¨æ¸…æ™°çš„éŒ„éŸ³è¨­å‚™</li>
                            <li><i class="fa fa-check text-success"></i> é¿å…èƒŒæ™¯å™ªéŸ³å¹²æ“¾</li>
                            <li><i class="fa fa-check text-success"></i> ç¢ºä¿éŸ³é‡é©ä¸­</li>
                            <li><i class="fa fa-check text-success"></i> å»ºè­°é•·åº¦ä¸è¶…é 2 å°æ™‚</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-6">
        <div class="x_panel fade-in">
            <div class="x_title">
                <h2><i class="fa fa-question-circle"></i> AI è™•ç†æµç¨‹</h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div class="timeline-compact">
                    <div class="timeline-item">
                        <div class="timeline-marker bg-info"></div>
                        <div class="timeline-content">
                            <h6>éŸ³è¨Šé è™•ç†</h6>
                            <p>æ ¼å¼è½‰æ›èˆ‡éŸ³è³ªå„ªåŒ–</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-primary"></div>
                        <div class="timeline-content">
                            <h6>èªéŸ³è½‰æ–‡å­—</h6>
                            <p>OpenAI Whisper AI è½‰éŒ„</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-warning"></div>
                        <div class="timeline-content">
                            <h6>èªè€…è¾¨è­˜</h6>
                            <p>æ™ºæ…§è­˜åˆ¥ä¸åŒç™¼è¨€è€…</p>
                        </div>
                    </div>
                    <div class="timeline-item">
                        <div class="timeline-marker bg-success"></div>
                        <div class="timeline-content">
                            <h6>æ™ºæ…§åˆ†æ</h6>
                            <p>ç”Ÿæˆæ‘˜è¦èˆ‡è¡Œå‹•é …ç›®</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- æœ€è¿‘çš„è™•ç†è¨˜éŒ„ - æ”¹ç‚ºæ‘ºç–Šå¼ -->
<div class="row">
    <div class="col-md-12">
        <div class="x_panel fade-in">
            <div class="x_title">
                <h2><i class="fa fa-clock-o"></i> æœ€è¿‘çš„è™•ç†è¨˜éŒ„</h2>
                <ul class="nav navbar-right panel_toolbox">
                    <li><a class="collapse-link"><i class="fa fa-chevron-up"></i></a></li>
                </ul>
                <div class="clearfix"></div>
            </div>
            <div class="x_content">
                <div id="recentMeetings">
                    <div class="text-center" style="padding: 2rem;">
                        <i class="fa fa-spinner fa-spin fa-2x text-primary"></i>
                        <p class="text-muted" style="margin-top: 1rem;">è¼‰å…¥æœ€è¿‘çš„æœƒè­°è¨˜éŒ„...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
/* ===== ä¸»è¦ä¸Šå‚³å€åŸŸæ¨£å¼ ===== */
.upload-main-panel {
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    border-radius: 8px;
    border: none;
}

.format-info-permanent {
    border-radius: 6px;
    border-left: 4px solid #5bc0de !important;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
}

.upload-area.enhanced {
    background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
    border: 2px dashed #ddd;
    border-radius: 12px;
    padding: 3rem 2rem;
    text-align: center;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.upload-area.enhanced:hover {
    border-color: #5cb85c;
    background: linear-gradient(135deg, #f0fff4 0%, #f8fff8 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(92, 184, 92, 0.15);
}

.upload-area.enhanced.dragover {
    border-color: #5cb85c;
    background: linear-gradient(135deg, #e8f5e8 0%, #f0fff4 100%);
    transform: scale(1.02);
}

.upload-icon {
    font-size: 4rem;
    color: #5cb85c;
    margin-bottom: 1rem;
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-10px); }
    60% { transform: translateY(-5px); }
}

.upload-content h3 {
    color: #333;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.upload-subtitle {
    color: #666;
    font-size: 1.1rem;
    margin-bottom: 2rem;
}

.upload-btn {
    padding: 12px 30px;
    font-size: 1.1rem;
    border-radius: 25px;
    transition: all 0.3s ease;
}

.upload-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(51, 122, 183, 0.3);
}

/* ===== æª”æ¡ˆé è¦½æ¨£å¼ ===== */
.file-info.enhanced {
    background: linear-gradient(135deg, #e8f5e8 0%, #f0fff4 100%);
    border: 1px solid #5cb85c;
    border-radius: 8px;
    padding: 2rem;
    animation: slideIn 0.5s ease;
}

@keyframes slideIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.file-preview {
    display: flex;
    align-items: center;
    margin-bottom: 1.5rem;
}

.file-icon {
    font-size: 3rem;
    color: #5cb85c;
    margin-right: 1rem;
}

.file-details h5 {
    margin: 0;
    font-weight: 600;
    color: #333;
}

.file-meta {
    margin: 0.25rem 0 0 0;
    color: #666;
    font-size: 0.9rem;
}

.process-btn {
    width: 100%;
    padding: 15px;
    font-size: 1.1rem;
    border-radius: 6px;
}

/* ===== é€²åº¦æ¢æ¨£å¼ ===== */
.progress-container.enhanced {
    background: #fff;
    border: 1px solid #e3e3e3;
    border-radius: 8px;
    padding: 2rem;
    animation: fadeIn 0.5s ease;
}

.progress-header {
    text-align: center;
    margin-bottom: 2rem;
}

.progress-header h4 {
    color: #333;
    margin-bottom: 0.5rem;
}

.progress-description {
    color: #666;
    font-size: 1rem;
}

/* ===== æ©«å‘æ­¥é©ŸæŒ‡ç¤ºå™¨ ===== */
.processing-steps-horizontal {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
    flex-wrap: wrap;
    gap: 10px;
}

.step-card {
    flex: 1;
    min-width: 120px;
    background: #f8f9fa;
    border: 1px solid #e3e3e3;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    transition: all 0.3s ease;
}

.step-card.active {
    background: linear-gradient(135deg, #5cb85c, #4cae4c);
    border-color: #5cb85c;
    color: white;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(92, 184, 92, 0.3);
}

.step-card.completed {
    background: linear-gradient(135deg, #5bc0de, #46b8da);
    border-color: #5bc0de;
    color: white;
}

.step-icon {
    font-size: 1.5rem;
    margin-bottom: 0.5rem;
}

.step-label {
    font-size: 0.85rem;
    font-weight: 600;
}

/* ===== æ™‚é–“è»¸æ¨£å¼å„ªåŒ– ===== */
.timeline-compact {
    position: relative;
    padding-left: 25px;
}

.timeline-compact::before {
    content: '';
    position: absolute;
    left: 12px;
    top: 0;
    bottom: 0;
    width: 2px;
    background: linear-gradient(to bottom, #5bc0de, #5cb85c);
}

.timeline-item {
    position: relative;
    margin-bottom: 1.5rem;
}

.timeline-marker {
    position: absolute;
    left: -18px;
    top: 3px;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    border: 2px solid #fff;
    box-shadow: 0 0 0 2px #ddd;
}

.timeline-content h6 {
    margin: 0 0 0.25rem 0;
    font-weight: 600;
    color: #333;
}

.timeline-content p {
    margin: 0;
    font-size: 0.9rem;
    color: #666;
}

/* ===== å“è³ªæç¤ºæ¨£å¼ ===== */
.quality-tips li {
    padding: 0.25rem 0;
    font-size: 0.9rem;
}

.quality-tips .fa {
    margin-right: 0.5rem;
}

/* ===== éŸ¿æ‡‰å¼è¨­è¨ˆ ===== */
@media (max-width: 768px) {
    .upload-area.enhanced {
        padding: 2rem 1rem;
    }
    
    .upload-icon {
        font-size: 3rem;
    }
    
    .processing-steps-horizontal {
        flex-direction: column;
    }
    
    .step-card {
        margin-bottom: 0.5rem;
    }
    
    .format-info .row .col-md-8,
    .format-info .row .col-md-4 {
        margin-bottom: 1rem;
    }
}

/* ===== æ·¡å…¥å‹•ç•« ===== */
.fade-in {
    animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ===== èƒŒæ™¯è‰²å½©è®Šæ•¸å…¼å®¹ ===== */
.bg-info { background-color: #5bc0de !important; }
.bg-primary { background-color: #337ab7 !important; }
.bg-warning { background-color: #f0ad4e !important; }
.bg-success { background-color: #5cb85c !important; }
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // ===== èª¿è©¦åŠŸèƒ½ =====
    console.log('ğŸ” é–‹å§‹èª¿è©¦æ¨¡å¼');
    
    // æª¢æŸ¥ Gentelella è…³æœ¬
    console.log('ğŸ” æª¢æŸ¥ Gentelella è…³æœ¬:');
    
    // å°‹æ‰¾æ‰€æœ‰å·²è¼‰å…¥çš„è…³æœ¬
    const allScripts = Array.from(document.scripts).map(s => s.src);
    const gentelellaScript = allScripts.find(src => src.includes('gentelella') && src.includes('custom.min.js'));
    
    if (gentelellaScript) {
        console.log('âœ… æ‰¾åˆ° Gentelella è…³æœ¬:', gentelellaScript);
        
        // å˜—è©¦æª¢æŸ¥ Gentelella ä¸­å¯èƒ½å½±éŸ¿ Alert çš„å‡½æ•¸
        console.log('ğŸ” æª¢æŸ¥ Gentelella ä¸­çš„ Alert ç›¸é—œåŠŸèƒ½:');
        
        // æª¢æŸ¥æ˜¯å¦æœ‰è‡ªå‹•é—œé–‰ alert çš„ä»£ç¢¼
        if (typeof $.fn.alert !== 'undefined') {
            console.log('  Bootstrap Alert æ’ä»¶: âœ… å·²è¼‰å…¥');
            console.log('  Alert åŸå§‹æ–¹æ³•:', $.fn.alert.Constructor.prototype);
        } else {
            console.log('  Bootstrap Alert æ’ä»¶: âŒ æœªè¼‰å…¥');
        }
        
        // æª¢æŸ¥ Gentelella æ˜¯å¦ä¿®æ”¹äº† alert ç›¸é—œæ–¹æ³•
        if (window.Gentelella) {
            console.log('  Gentelella å…¨å±€å°è±¡:', window.Gentelella);
        } else {
            console.log('  æœªæ‰¾åˆ° Gentelella å…¨å±€å°è±¡');
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰ä»»ä½•å…¨å±€å‡½æ•¸è™•ç† alert
        const possibleAlertHandlers = [
            'closeAlert', 
            'hideAlert', 
            'dismissAlert', 
            'handleAlert', 
            'autoCloseAlert'
        ];
        
        possibleAlertHandlers.forEach(handler => {
            if (typeof window[handler] === 'function') {
                console.log(`  æ‰¾åˆ°å¯èƒ½çš„ Alert è™•ç†å‡½æ•¸: ${handler}`);
            }
        });
        
        // æª¢æŸ¥ document ä¸Šæ˜¯å¦æœ‰ alert ç›¸é—œäº‹ä»¶
        try {
            const docEvents = $._data(document, 'events') || {};
            console.log('  Document äº‹ä»¶:', docEvents);
            
            // ç‰¹åˆ¥æª¢æŸ¥é»æ“Šäº‹ä»¶ä¸­æ˜¯å¦æœ‰ alert ç›¸é—œè™•ç†
            if (docEvents.click) {
                docEvents.click.forEach((handler, i) => {
                    const handlerStr = handler.handler.toString();
                    if (handlerStr.includes('alert') || handlerStr.includes('dismiss')) {
                        console.log(`  é»æ“Šäº‹ä»¶ #${i} å¯èƒ½è™•ç† Alert:`, handlerStr.substring(0, 100) + '...');
                    }
                });
            }
        } catch (e) {
            console.log('  ç„¡æ³•æª¢æŸ¥æ–‡æª”äº‹ä»¶:', e);
        }
    } else {
        console.warn('âš ï¸ æœªæ‰¾åˆ° Gentelella è…³æœ¬');
    }
    
    // ç›£æ§æ ¼å¼èªªæ˜å€åŸŸ
    const formatInfo = document.querySelector('.format-info-permanent');
    if (formatInfo) {
        console.log('âœ… æ‰¾åˆ°æ ¼å¼èªªæ˜å€åŸŸ:', formatInfo);
        
        // ç›£æ§ DOM è®ŠåŒ–
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    mutation.removedNodes.forEach(function(node) {
                        if (node.nodeType === 1) { // Element node
                            if (node.classList && node.classList.contains('format-info-permanent')) {
                                console.error('âŒ æ ¼å¼èªªæ˜è¢«åˆªé™¤äº†ï¼', node);
                                console.trace('åˆªé™¤çš„èª¿ç”¨å †ç–Š');
                            }
                            if (node.classList && node.classList.contains('alert')) {
                                console.warn('âš ï¸ Alert å…ƒç´ è¢«åˆªé™¤:', node.className);
                            }
                        }
                    });
                }
            });
        });
        
        observer.observe(document.body, { 
            childList: true, 
            subtree: true 
        });
        
        // å®šæœŸæª¢æŸ¥æ ¼å¼èªªæ˜æ˜¯å¦é‚„å­˜åœ¨
        setInterval(function() {
            const stillExists = document.querySelector('.format-info-permanent');
            if (!stillExists) {
                console.error('âŒ æ ¼å¼èªªæ˜å€åŸŸæ¶ˆå¤±äº†ï¼æ™‚é–“:', new Date().toLocaleTimeString());
            }
        }, 2000);
        
    } else {
        console.error('âŒ æ‰¾ä¸åˆ°æ ¼å¼èªªæ˜å€åŸŸ');
    }
    
    // ç›£æ§æ‰€æœ‰å¯èƒ½å½±éŸ¿ alert çš„æ“ä½œ
    const originalRemove = jQuery.fn.remove;
    jQuery.fn.remove = function() {
        if (this.hasClass('format-info-permanent')) {
            console.error('âŒ å˜—è©¦åˆªé™¤æ ¼å¼èªªæ˜ï¼', this);
            console.trace('èª¿ç”¨å †ç–Š');
            return this; // é˜»æ­¢åˆªé™¤
        }
        if (this.hasClass('alert')) {
            console.log('ğŸ—‘ï¸ åˆªé™¤ Alert å…ƒç´ :', this.attr('class'));
        }
        return originalRemove.apply(this, arguments);
    };
    
    // ç›£æ§ fadeOut æ“ä½œ
    const originalFadeOut = jQuery.fn.fadeOut;
    jQuery.fn.fadeOut = function() {
        if (this.hasClass('format-info-permanent')) {
            console.error('âŒ å˜—è©¦æ·¡å‡ºæ ¼å¼èªªæ˜ï¼', this);
            console.trace('èª¿ç”¨å †ç–Š');
            return this; // é˜»æ­¢æ·¡å‡º
        }
        if (this.hasClass('alert')) {
            console.log('ğŸ‘» æ·¡å‡º Alert å…ƒç´ :', this.attr('class'));
            console.trace('æ·¡å‡ºèª¿ç”¨å †ç–Š');
        }
        return originalFadeOut.apply(this, arguments);
    };
    
    // ç›£æ§ hide/slideUp æ“ä½œ
    const originalHide = jQuery.fn.hide;
    jQuery.fn.hide = function() {
        if (this.hasClass('format-info-permanent')) {
            console.error('âŒ å˜—è©¦éš±è—æ ¼å¼èªªæ˜ï¼', this);
            console.trace('èª¿ç”¨å †ç–Š');
            return this; // é˜»æ­¢éš±è—
        }
        if (this.hasClass('alert')) {
            console.log('ğŸ™ˆ éš±è— Alert å…ƒç´ :', this.attr('class'));
            console.trace('éš±è—èª¿ç”¨å †ç–Š');
        }
        return originalHide.apply(this, arguments);
    };
    
    // ç›£æ§ Bootstrap çš„ alert æ’ä»¶
    if ($.fn.alert && $.fn.alert.Constructor) {
        console.log('ğŸ”„ ç›£æ§ Bootstrap Alert æ’ä»¶');
        
        const originalClose = $.fn.alert.Constructor.prototype.close;
        $.fn.alert.Constructor.prototype.close = function(e) {
            const $this = $(this);
            console.log('ğŸšª Bootstrap Alert é—œé–‰è§¸ç™¼:', $this.attr('class'));
            
            if ($this.hasClass('format-info-permanent')) {
                console.error('âŒ Bootstrap å˜—è©¦é—œé–‰æ ¼å¼èªªæ˜ï¼');
                console.trace('Bootstrap é—œé–‰èª¿ç”¨å †ç–Š');
                return; // é˜»æ­¢é—œé–‰
            }
            
            return originalClose.apply(this, arguments);
        };
    }
    
    // ===== åŸæœ‰åŠŸèƒ½ä»£ç¢¼ =====
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');
    const uploadProgress = document.getElementById('uploadProgress');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    console.log('ğŸ¯ åˆå§‹åŒ–ä¸Šå‚³çµ„ä»¶:', {
        uploadArea: !!uploadArea,
        fileInput: !!fileInput,
        fileInfo: !!fileInfo
    });
    
    // æ‹–æ”¾åŠŸèƒ½
    if (uploadArea) {
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            uploadArea.classList.add('dragover');
            console.log('ğŸ“‚ æ‹–æ”¾: dragover');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            console.log('ğŸ“‚ æ‹–æ”¾: dragleave');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            console.log('ğŸ“‚ æ‹–æ”¾: drop');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelection(files[0]);
            }
        });
    }
    
    // æª”æ¡ˆé¸æ“‡è™•ç†
    if (fileInput) {
        fileInput.addEventListener('change', function(e) {
            console.log('ğŸ“ æª”æ¡ˆé¸æ“‡:', e.target.files.length);
            if (e.target.files.length > 0) {
                handleFileSelection(e.target.files[0]);
            }
        });
    }
    
    function handleFileSelection(file) {
        console.log('ğŸ” è™•ç†æª”æ¡ˆé¸æ“‡:', file.name, file.size);
        
        // æª¢æŸ¥æª”æ¡ˆé¡å‹
        const allowedExtensions = ['.m4a', '.mp3', '.wav', '.flac', '.webm'];
        const fileExtension = '.' + file.name.split('.').pop().toLowerCase();
        
        if (!allowedExtensions.includes(fileExtension)) {
            console.log('âŒ æª”æ¡ˆæ ¼å¼ä¸æ”¯æ´:', fileExtension);
            showAlert('ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼ï¼è«‹é¸æ“‡ M4Aã€MP3ã€WAVã€FLAC æˆ– WebM æ ¼å¼çš„æª”æ¡ˆã€‚', 'danger');
            return;
        }
        
        // æª¢æŸ¥æª”æ¡ˆå¤§å° (500MB é™åˆ¶)
        if (file.size > 500 * 1024 * 1024) {
            console.log('âŒ æª”æ¡ˆå¤ªå¤§:', file.size);
            showAlert('æª”æ¡ˆå¤ªå¤§ï¼è«‹é¸æ“‡å°æ–¼ 500MB çš„æª”æ¡ˆã€‚', 'danger');
            return;
        }
        
        // é¡¯ç¤ºæª”æ¡ˆè³‡è¨Š
        if (fileName) fileName.textContent = file.name;
        if (fileSize) fileSize.textContent = formatFileSize(file.size);
        if (fileInfo) fileInfo.style.display = 'block';
        
        console.log('âœ… æª”æ¡ˆé¸æ“‡æˆåŠŸï¼Œéš±è—é€²éšè¨­å®š');
        // éš±è—é€²éšè¨­å®šé¢æ¿ï¼Œè®“ä½¿ç”¨è€…å°ˆæ³¨æ–¼ä¸Šå‚³
        $('#advancedSection').slideUp();
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB', 'GB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
    }
    
    // è¡¨å–®æäº¤è™•ç†
    $('#uploadForm').on('submit', function(e) {
        e.preventDefault();
        console.log('ğŸ“¤ è¡¨å–®æäº¤');
        
        if (!fileInput || !fileInput.files[0]) {
            console.log('âŒ æ²’æœ‰é¸æ“‡æª”æ¡ˆ');
            showAlert('è«‹å…ˆé¸æ“‡è¦ä¸Šå‚³çš„æª”æ¡ˆï¼', 'warning');
            return;
        }
        
        startUploadProcess();
    });
    
    function startUploadProcess() {
        console.log('ğŸš€ é–‹å§‹ä¸Šå‚³æµç¨‹');
        // éš±è—ä¸Šå‚³å€åŸŸï¼Œé¡¯ç¤ºé€²åº¦
        $('#uploadArea').slideUp();
        $('#uploadProgress').slideDown();
        updateProcessingSteps(1);
        
        const formData = new FormData(document.getElementById('uploadForm'));
        const xhr = new XMLHttpRequest();
        
        xhr.open('POST', $('#uploadForm').attr('action'), true);
        
        // ä¸Šå‚³é€²åº¦
        xhr.upload.onprogress = function(e) {
            if (e.lengthComputable) {
                const percentComplete = (e.loaded / e.total) * 100;
                if (progressBar) progressBar.style.width = percentComplete + '%';
                if (progressText) progressText.textContent = `æª”æ¡ˆä¸Šå‚³ä¸­... ${Math.round(percentComplete)}%`;
            }
        };
        
        // ä¸Šå‚³å®Œæˆ
        xhr.onload = function() {
            console.log('ğŸ“¤ ä¸Šå‚³å®Œæˆï¼Œç‹€æ…‹:', xhr.status);
            if (progressBar) progressBar.style.width = '100%';
            
            if (xhr.status >= 200 && xhr.status < 300) {
                try {
                    const response = JSON.parse(xhr.responseText);
                    console.log('ğŸ“ æœå‹™å™¨å›æ‡‰:', response);
                    if (response.status === 'success') {
                        if (progressText) progressText.textContent = 'âœ… ä¸Šå‚³æˆåŠŸï¼å¾Œç«¯è™•ç†ä¸­...';
                        updateProcessingSteps(2);
                        
                        showAlert('ğŸ‰ æª”æ¡ˆä¸Šå‚³æˆåŠŸï¼å¾Œç«¯æ­£åœ¨è™•ç†ä¸­ï¼Œè«‹ç¨å€™...', 'success');
                        
                        // é–‹å§‹ç›£æ§è™•ç†é€²åº¦ï¼Œç­‰å¾…å®Œæˆå¾Œå†è·³è½‰
                        monitorProcessingProgress(response.meeting_id);
                        
                    } else {
                        throw new Error(response.message || 'æœªçŸ¥çš„éŒ¯èª¤');
                    }
                } catch (e) {
                    console.error('âŒ è™•ç†å›æ‡‰éŒ¯èª¤:', e);
                    if (progressText) progressText.textContent = 'âŒ è™•ç†å›æ‡‰å¤±æ•—ï¼';
                    showAlert(`è™•ç†ä¼ºæœå™¨å›æ‡‰æ™‚ç™¼ç”ŸéŒ¯èª¤: ${e.message}`, 'danger');
                    resetUploadInterface();
                }
            } else {
                let errorMessage = `ä¸Šå‚³å¤±æ•—: ${xhr.statusText}`;
                try {
                    const errorResponse = JSON.parse(xhr.responseText);
                    if (errorResponse.message) {
                        errorMessage = errorResponse.message;
                    }
                } catch (e) {}
                console.error('âŒ HTTP éŒ¯èª¤:', errorMessage);
                if (progressText) progressText.textContent = 'âŒ ä¸Šå‚³å¤±æ•—ï¼';
                showAlert(errorMessage, 'danger');
                resetUploadInterface();
            }
        };
        
        // ä¸Šå‚³å‡ºéŒ¯
        xhr.onerror = function() {
            console.error('âŒ ç¶²è·¯éŒ¯èª¤');
            if (progressText) progressText.textContent = 'âŒ ä¸Šå‚³æ™‚ç™¼ç”Ÿç¶²è·¯éŒ¯èª¤ï¼';
            showAlert('ä¸Šå‚³å¤±æ•—ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šã€‚', 'danger');
            resetUploadInterface();
        };
        
        xhr.send(formData);
    }
    
    function updateProcessingSteps(currentStep) {
        console.log('ğŸ“Š æ›´æ–°è™•ç†æ­¥é©Ÿ:', currentStep);
        const stepTexts = [
            'æª”æ¡ˆä¸Šå‚³ä¸­...',
            'éŸ³è¨Šé è™•ç†ä¸­...',
            'èªéŸ³è½‰æ–‡å­—ä¸­...',
            'èªè€…è¾¨è­˜ä¸­...',
            'ç”Ÿæˆçµæœä¸­...',
            'è™•ç†å®Œæˆï¼'
        ];
        
        if (currentStep > 0 && currentStep <= stepTexts.length) {
            if (progressText) progressText.textContent = stepTexts[currentStep - 1];
        }

        for (let i = 1; i <= 5; i++) {
            const stepElement = document.getElementById(`step${i}`);
            if (!stepElement) continue;

            const icon = stepElement.querySelector('.step-icon i');
            
            if (i < currentStep || currentStep === 6) {
                // å¦‚æœæ˜¯å®Œæˆç‹€æ…‹ï¼ˆæ­¥é©Ÿ6ï¼‰æˆ–å·²å®Œæˆçš„æ­¥é©Ÿ
                stepElement.className = 'step-card completed';
                if (icon) icon.className = 'fa fa-check';
            } else if (i === currentStep && currentStep < 6) {
                stepElement.className = 'step-card active';
                if (i === 1) {
                    if (icon) icon.className = 'fa fa-upload';
                } else {
                    if (icon) icon.className = 'fa fa-cog fa-spin';
                }
            } else {
                stepElement.className = 'step-card';
                if (icon) icon.className = 'fa fa-circle-o';
            }
        }
        
        // å¦‚æœæ˜¯å®Œæˆç‹€æ…‹ï¼Œæ›´æ–°é€²åº¦æ¢ç‚º100%
        if (currentStep === 6 && progressBar) {
            progressBar.style.width = '100%';
        }
    }
    
    function showAlert(message, type) {
        console.log('ğŸš¨ é¡¯ç¤ºæé†’:', type, message);
        
        // è¨˜éŒ„ç•¶å‰æ‰€æœ‰ alert å…ƒç´ 
        const existingAlerts = document.querySelectorAll('.alert');
        console.log('ğŸ“‹ ç•¶å‰ Alert å…ƒç´ :', existingAlerts.length);
        existingAlerts.forEach((alert, index) => {
            console.log(`  ${index}: ${alert.className}`);
        });
        
        // åªç§»é™¤å‹•æ…‹ç”Ÿæˆçš„æé†’ï¼Œä¸å½±éŸ¿é é¢å›ºå®šå…§å®¹
        const toRemove = $('.dynamic-alert, .alert-dismissible:not(.format-info-permanent)');
        console.log('ğŸ—‘ï¸ æº–å‚™ç§»é™¤çš„ Alert:', toRemove.length);
        toRemove.each(function(index) {
            console.log(`  ç§»é™¤ ${index}: ${this.className}`);
        });
        toRemove.remove();

        const alertHtml = `
            <div class="alert alert-${type} alert-dismissible fade in dynamic-alert" role="alert" style="margin-top: 1rem; position: fixed; top: 80px; left: 50%; transform: translateX(-50%); z-index: 9999; min-width: 300px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); border-radius: 6px;">
                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                    <span aria-hidden="true">Ã—</span>
                </button>
                ${message}
            </div>
        `;
        
        $('body').prepend(alertHtml);
        console.log('â• æ–°å¢å‹•æ…‹æé†’');
        
        setTimeout(() => {
            $('.dynamic-alert').fadeOut(function() { $(this).remove(); });
            console.log('â° è‡ªå‹•ç§»é™¤å‹•æ…‹æé†’');
        }, 5000);
    }
    
    function resetUploadInterface() {
        console.log('ğŸ”„ é‡ç½®ä¸Šå‚³ä»‹é¢');
        $('#uploadProgress').slideUp();
        $('#uploadArea').slideDown();
        $('#advancedSection').slideDown();
        if (fileInfo) fileInfo.style.display = 'none';
        if (fileInput) fileInput.value = '';
        if (progressBar) progressBar.style.width = '0%';
        updateProcessingSteps(0);
    }
    
    function monitorProcessingProgress(meetingId) {
        console.log('ğŸ“Š é–‹å§‹ç›£æ§è™•ç†é€²åº¦:', meetingId);
        
        // ä½¿ç”¨ Server-Sent Events ä¾†ç›£æ§è™•ç†é€²åº¦
        const eventSource = new EventSource(`/meetings/${meetingId}/stream`);
        
        eventSource.onmessage = function(event) {
            try {
                const data = JSON.parse(event.data);
                console.log('ğŸ“ˆ æ”¶åˆ°é€²åº¦æ›´æ–°:', data);
                
                // æ›´æ–°é€²åº¦é¡¯ç¤º
                if (data.step && data.message) {
                    if (progressText) progressText.textContent = data.message;
                    
                    // æ ¹æ“šæ­¥é©Ÿæ›´æ–°è™•ç†éšæ®µ
                    const stepMap = {
                        'preprocessing': 2,
                        'transcription': 3,
                        'diarization': 4,
                        'merge': 5,
                        'completed': 6
                    };
                    
                    if (stepMap[data.step]) {
                        updateProcessingSteps(stepMap[data.step]);
                    }
                }
                
                // å¦‚æœè™•ç†å®Œæˆï¼Œè·³è½‰åˆ°çµæœé é¢
                if (data.step === 'completed') {
                    console.log('âœ… è™•ç†å®Œæˆï¼Œæº–å‚™è·³è½‰');
                    eventSource.close();
                    
                    showAlert('ğŸ‰ è™•ç†å®Œæˆï¼å³å°‡è·³è½‰åˆ°çµæœé é¢...', 'success');
                    
                    setTimeout(() => {
                        window.location.href = `/meetings/${meetingId}`;
                    }, 1500);
                }
                
                // å¦‚æœè™•ç†å¤±æ•—ï¼Œé¡¯ç¤ºéŒ¯èª¤ä¸¦é‡ç½®ä»‹é¢
                if (data.step === 'failed' || data.step === 'error') {
                    console.error('âŒ è™•ç†å¤±æ•—:', data.message);
                    eventSource.close();
                    
                    showAlert(`è™•ç†å¤±æ•—: ${data.message || 'æœªçŸ¥éŒ¯èª¤'}`, 'danger');
                    resetUploadInterface();
                }
                
            } catch (e) {
                console.error('âŒ è§£æé€²åº¦è³‡æ–™å¤±æ•—:', e);
            }
        };
        
        eventSource.onerror = function(error) {
            console.error('âŒ é€²åº¦ç›£æ§é€£ç·šéŒ¯èª¤:', error);
            eventSource.close();
            
            // å¦‚æœé€£ç·šå¤±æ•—ï¼Œç­‰å¾…ä¸€æ®µæ™‚é–“å¾Œè·³è½‰ï¼ˆä½œç‚ºå‚™ç”¨æ–¹æ¡ˆï¼‰
            showAlert('âš ï¸ ç„¡æ³•ç›£æ§è™•ç†é€²åº¦ï¼Œå°‡åœ¨ç¨å¾Œè·³è½‰åˆ°çµæœé é¢...', 'warning');
            
            setTimeout(() => {
                window.location.href = `/meetings/${meetingId}`;
            }, 10000); // 10ç§’å¾Œè·³è½‰
        };
        
        // è¨­ç½®è¶…æ™‚ä¿è­·ï¼ˆ30åˆ†é˜ï¼‰
        setTimeout(() => {
            if (eventSource.readyState !== EventSource.CLOSED) {
                console.warn('â° è™•ç†è¶…æ™‚ï¼Œå¼·åˆ¶è·³è½‰');
                eventSource.close();
                showAlert('âš ï¸ è™•ç†æ™‚é–“è¼ƒé•·ï¼Œå°‡è·³è½‰åˆ°çµæœé é¢æŸ¥çœ‹ç‹€æ…‹...', 'warning');
                window.location.href = `/meetings/${meetingId}`;
            }
        }, 30 * 60 * 1000); // 30åˆ†é˜è¶…æ™‚
    }
    
    // è¼‰å…¥æœ€è¿‘çš„æœƒè­°è¨˜éŒ„
    loadRecentMeetings();
    
    function loadRecentMeetings() {
        console.log('ğŸ“š è¼‰å…¥æœ€è¿‘æœƒè­°è¨˜éŒ„');
        
        // ç™¼é€AJAXè«‹æ±‚ç²å–æœ€è¿‘çš„æœƒè­°è¨˜éŒ„
        $.ajax({
            url: '{{ url_for("main.get_recent_meetings") }}',
            method: 'GET',
            dataType: 'json',
            success: function(response) {
                console.log('ğŸ“ ç²å–æœƒè­°è¨˜éŒ„å›æ‡‰:', response);
                
                if (response.status === 'success' && response.meetings && response.meetings.length > 0) {
                    // æœ‰æœƒè­°è¨˜éŒ„ï¼Œé¡¯ç¤ºåˆ—è¡¨
                    let meetingsHtml = '<div class="recent-meetings-list">';
                    
                    response.meetings.forEach(function(meeting, index) {
                        const statusIcon = getStatusIcon(meeting.status);
                        const statusText = getStatusText(meeting.status);
                        const duration = meeting.duration ? `${(meeting.duration/60).toFixed(1)} åˆ†é˜` : '-';
                        const speakers = meeting.num_speakers ? `${meeting.num_speakers} ä½ç™¼è¨€è€…` : '-';
                        const createdAt = formatDateTime(meeting.created_at);
                        
                        meetingsHtml += `
                            <div class="recent-meeting-item" style="animation-delay: ${index * 0.1}s;">
                                <div class="meeting-header">
                                    <div class="meeting-title">
                                        <i class="fa fa-file-audio-o"></i>
                                        <span class="filename">${meeting.original_filename}</span>
                                    </div>
                                    <div class="meeting-status status-${meeting.status}">
                                        ${statusIcon} ${statusText}
                                    </div>
                                </div>
                                <div class="meeting-meta">
                                    <span><i class="fa fa-calendar"></i> ${createdAt}</span>
                                    <span><i class="fa fa-clock"></i> ${duration}</span>
                                    <span><i class="fa fa-users"></i> ${speakers}</span>
                                </div>
                                <div class="meeting-actions">
                                    <a href="/meetings/${meeting.id}" class="btn btn-sm btn-info">
                                        <i class="fa fa-eye"></i> æŸ¥çœ‹è©³æƒ…
                                    </a>
                                </div>
                            </div>
                        `;
                    });
                    
                    meetingsHtml += '</div>';
                    
                    // å¦‚æœæœ‰æ›´å¤šæœƒè­°è¨˜éŒ„ï¼Œé¡¯ç¤ºæŸ¥çœ‹å…¨éƒ¨æŒ‰éˆ•
                    if (response.total_count > response.meetings.length) {
                        meetingsHtml += `
                            <div class="text-center" style="margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #eee;">
                                <p class="text-muted" style="margin-bottom: 1rem;">
                                    é‚„æœ‰ ${response.total_count - response.meetings.length} ç­†æœƒè­°è¨˜éŒ„
                                </p>
                                <a href="{{ url_for('main.meetings_list') }}" class="btn btn-info">
                                    <i class="fa fa-list"></i> æŸ¥çœ‹æ‰€æœ‰æœƒè­°è¨˜éŒ„
                                </a>
                            </div>
                        `;
                    }
                    
                    $('#recentMeetings').html(meetingsHtml);
                } else {
                    // æ²’æœ‰æœƒè­°è¨˜éŒ„
                    $('#recentMeetings').html(`
                        <div class="text-center" style="padding: 2rem;">
                            <i class="fa fa-inbox" style="font-size: 3rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <p class="text-muted" style="margin-bottom: 1rem;">å°šç„¡æœƒè­°è¨˜éŒ„</p>
                            <a href="{{ url_for('main.meetings_list') }}" class="btn btn-info">
                                <i class="fa fa-arrow-right"></i> æŸ¥çœ‹æ‰€æœ‰æœƒè­°è¨˜éŒ„
                            </a>
                        </div>
                    `);
                }
                
                console.log('âœ… æœƒè­°è¨˜éŒ„è¼‰å…¥å®Œæˆ');
            },
            error: function(xhr, status, error) {
                console.error('âŒ è¼‰å…¥æœƒè­°è¨˜éŒ„å¤±æ•—:', error);
                $('#recentMeetings').html(`
                    <div class="text-center" style="padding: 2rem;">
                        <i class="fa fa-exclamation-triangle" style="font-size: 2rem; color: #f39c12; margin-bottom: 1rem;"></i>
                        <p class="text-muted" style="margin-bottom: 1rem;">è¼‰å…¥æœƒè­°è¨˜éŒ„å¤±æ•—</p>
                        <button class="btn btn-warning btn-sm" onclick="loadRecentMeetings()">
                            <i class="fa fa-refresh"></i> é‡æ–°è¼‰å…¥
                        </button>
                    </div>
                `);
            }
        });
    }
    
    // è¼”åŠ©å‡½æ•¸ï¼šç²å–ç‹€æ…‹åœ–ç¤º
    function getStatusIcon(status) {
        const icons = {
            'uploaded': '<i class="fa fa-clock"></i>',
            'processing': '<i class="fa fa-spinner fa-spin"></i>',
            'completed': '<i class="fa fa-check-circle"></i>',
            'failed': '<i class="fa fa-times-circle"></i>'
        };
        return icons[status] || '<i class="fa fa-question-circle"></i>';
    }
    
    // è¼”åŠ©å‡½æ•¸ï¼šç²å–ç‹€æ…‹æ–‡å­—
    function getStatusText(status) {
        const texts = {
            'uploaded': 'å·²ä¸Šå‚³',
            'processing': 'è™•ç†ä¸­',
            'completed': 'å·²å®Œæˆ',
            'failed': 'å¤±æ•—'
        };
        return texts[status] || 'æœªçŸ¥';
    }
    
    // è¼”åŠ©å‡½æ•¸ï¼šæ ¼å¼åŒ–æ—¥æœŸæ™‚é–“
    function formatDateTime(dateTimeStr) {
        if (!dateTimeStr) return '-';
        
        try {
            const date = new Date(dateTimeStr);
            const now = new Date();
            const diffMs = now - date;
            const diffMins = Math.floor(diffMs / (1000 * 60));
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffMins < 1) {
                return 'å‰›å‰›';
            } else if (diffMins < 60) {
                return `${diffMins} åˆ†é˜å‰`;
            } else if (diffHours < 24) {
                return `${diffHours} å°æ™‚å‰`;
            } else if (diffDays < 7) {
                return `${diffDays} å¤©å‰`;
            } else {
                return date.toLocaleDateString('zh-TW', {
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            }
        } catch (e) {
            console.error('æ—¥æœŸæ ¼å¼åŒ–éŒ¯èª¤:', e);
            return dateTimeStr;
        }
    }
    
    // é é¢è¼‰å…¥å‹•ç•«
    const elements = document.querySelectorAll('.fade-in');
    elements.forEach((el, index) => {
        el.style.animationDelay = `${index * 0.1}s`;
    });
    
    console.log('ğŸ‰ é é¢åˆå§‹åŒ–å®Œæˆ');
    
    // æœ€çµ‚æª¢æŸ¥
    setTimeout(() => {
        const finalCheck = document.querySelector('.format-info-permanent');
        if (finalCheck) {
            console.log('âœ… æœ€çµ‚æª¢æŸ¥ï¼šæ ¼å¼èªªæ˜å€åŸŸå­˜åœ¨');
        } else {
            console.error('âŒ æœ€çµ‚æª¢æŸ¥ï¼šæ ¼å¼èªªæ˜å€åŸŸä¸å­˜åœ¨ï¼');
        }
    }, 3000);
});
</script>
{% endblock %}